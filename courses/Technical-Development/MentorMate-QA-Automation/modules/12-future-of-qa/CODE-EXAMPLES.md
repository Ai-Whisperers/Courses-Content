# Module 12: AI-Assisted Testing & Advanced Workflows
## Code Examples

---

## Example 1: Effective AI Prompts for Test Generation

```markdown
# Prompt Template 1: Feature Test Generation

Generate Playwright tests in TypeScript for a shopping cart feature.

## Application Context
- Base URL: https://shop.example.com
- E-commerce application selling electronics
- Uses React frontend with data-testid attributes

## Feature: Shopping Cart
The cart allows users to:
- Add items from product pages
- View cart contents
- Update item quantities
- Remove items
- See subtotal and total with tax

## Element Selectors
- Add to cart button: data-testid="add-to-cart"
- Cart icon: data-testid="cart-icon"
- Cart count badge: data-testid="cart-count"
- Cart item: data-testid="cart-item"
- Quantity input: data-testid="quantity-input"
- Remove button: data-testid="remove-item"
- Subtotal: data-testid="subtotal"
- Total: data-testid="total"

## Test Scenarios Required
1. Add single item to empty cart
2. Add multiple items
3. Update item quantity
4. Remove item from cart
5. Verify price calculations
6. Empty cart behavior

## Technical Requirements
- Use Page Object Model
- Use @faker-js/faker for test data
- Include proper waits for loading states
- Handle async operations correctly
- Use Playwright 1.40+ syntax

## Output Format
1. CartPage class with all methods
2. Test file with describe/test blocks
3. Include assertions for each scenario
```

---

## Example 2: AI-Generated Page Object (with fixes noted)

```typescript
// pages/CartPage.ts
// Generated by AI, reviewed and fixed by QA engineer

import { Page, Locator, expect } from '@playwright/test';

export class CartPage {
  readonly page: Page;
  readonly cartIcon: Locator;
  readonly cartCount: Locator;
  readonly cartItems: Locator;
  readonly subtotal: Locator;
  readonly total: Locator;
  readonly emptyCartMessage: Locator;
  readonly checkoutButton: Locator;

  constructor(page: Page) {
    this.page = page;
    this.cartIcon = page.locator('[data-testid="cart-icon"]');
    this.cartCount = page.locator('[data-testid="cart-count"]');
    this.cartItems = page.locator('[data-testid="cart-item"]');
    this.subtotal = page.locator('[data-testid="subtotal"]');
    this.total = page.locator('[data-testid="total"]');
    this.emptyCartMessage = page.locator('[data-testid="empty-cart"]');
    this.checkoutButton = page.locator('[data-testid="checkout-btn"]');
  }

  async goto() {
    await this.page.goto('/cart');
    // FIX: Added wait for page to be ready
    await this.page.waitForLoadState('networkidle');
  }

  async openCart() {
    await this.cartIcon.click();
    // FIX: Wait for cart page to load
    await expect(this.page).toHaveURL(/cart/);
  }

  async getCartCount(): Promise<number> {
    const text = await this.cartCount.textContent();
    return parseInt(text || '0');
  }

  async getItemCount(): Promise<number> {
    return await this.cartItems.count();
  }

  async updateQuantity(itemIndex: number, quantity: number) {
    const item = this.cartItems.nth(itemIndex);
    const quantityInput = item.locator('[data-testid="quantity-input"]');

    // FIX: Clear field before typing
    await quantityInput.clear();
    await quantityInput.fill(quantity.toString());

    // FIX: Wait for price update
    await this.page.waitForResponse(resp =>
      resp.url().includes('/api/cart') && resp.status() === 200
    );
  }

  async removeItem(itemIndex: number) {
    const item = this.cartItems.nth(itemIndex);
    const removeButton = item.locator('[data-testid="remove-item"]');

    // FIX: Wait for button to be enabled
    await expect(removeButton).toBeEnabled();
    await removeButton.click();

    // FIX: Wait for item to be removed
    await expect(item).toBeHidden();
  }

  async getSubtotal(): Promise<number> {
    const text = await this.subtotal.textContent();
    // FIX: Handle currency formatting
    return parseFloat(text?.replace(/[^0-9.]/g, '') || '0');
  }

  async getTotal(): Promise<number> {
    const text = await this.total.textContent();
    return parseFloat(text?.replace(/[^0-9.]/g, '') || '0');
  }

  async isEmpty(): Promise<boolean> {
    return await this.emptyCartMessage.isVisible();
  }

  async proceedToCheckout() {
    await expect(this.checkoutButton).toBeEnabled();
    await this.checkoutButton.click();
    await expect(this.page).toHaveURL(/checkout/);
  }
}
```

---

## Example 3: Debugging Prompt and Response

```markdown
# Debugging Prompt

My Playwright test is failing with this error:

## Error Message
```
Error: Timeout 30000ms exceeded.
  =========================== logs ===========================
  waiting for locator('[data-testid="submit-btn"]')
  ============================================================
```

## Test Code
```typescript
test('user can submit form', async ({ page }) => {
  await page.goto('/contact');
  await page.fill('[data-testid="name"]', 'John Doe');
  await page.fill('[data-testid="email"]', 'john@example.com');
  await page.fill('[data-testid="message"]', 'Hello');
  await page.click('[data-testid="submit-btn"]');
  await expect(page.locator('.success')).toBeVisible();
});
```

## Page HTML
```html
<form id="contact-form">
  <input data-testid="name" type="text" />
  <input data-testid="email" type="email" />
  <textarea data-testid="message"></textarea>
  <button type="submit" data-testid="submit-button">Send</button>
</form>
```

What's wrong and how do I fix it?

---

# AI Response

The issue is a **selector mismatch**. Your test uses `submit-btn` but the HTML has `submit-button`.

## Fix

```typescript
// Change this:
await page.click('[data-testid="submit-btn"]');

// To this:
await page.click('[data-testid="submit-button"]');
```

## Prevention

1. Always verify selectors against actual HTML
2. Use consistent naming conventions
3. Consider adding a helper to validate selectors exist
```

---

## Example 4: Docker Configuration for Tests

```dockerfile
# Dockerfile
FROM mcr.microsoft.com/playwright:v1.56.0-jammy

# Set working directory
WORKDIR /app

# Copy package files first (better caching)
COPY package*.json ./

# Install dependencies
RUN npm ci

# Copy test files
COPY . .

# Set environment variables
ENV CI=true
ENV NODE_ENV=test

# Default command
CMD ["npx", "playwright", "test"]
```

```yaml
# docker-compose.yml
version: '3.8'

services:
  playwright-tests:
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      # Mount reports for viewing
      - ./playwright-report:/app/playwright-report
      - ./test-results:/app/test-results
    environment:
      - BASE_URL=${BASE_URL:-http://host.docker.internal:3000}
      - CI=true
    # For running against local app
    extra_hosts:
      - "host.docker.internal:host-gateway"

  # Optional: Run app alongside tests
  app:
    image: your-app-image
    ports:
      - "3000:3000"
```

```bash
# Commands
# Build image
docker build -t playwright-tests .

# Run tests
docker run --rm playwright-tests

# Run with mounted volumes
docker run --rm \
  -v $(pwd)/playwright-report:/app/playwright-report \
  playwright-tests

# Use docker-compose
docker-compose up --build --exit-code-from playwright-tests
```

---

## Example 5: GitHub Actions with Sharding

```yaml
# .github/workflows/playwright-sharded.yml
name: Playwright Tests (Sharded)

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  test:
    timeout-minutes: 60
    runs-on: ubuntu-latest
    container:
      image: mcr.microsoft.com/playwright:v1.56.0-jammy

    strategy:
      fail-fast: false
      matrix:
        shard: [1, 2, 3, 4]

    steps:
      - uses: actions/checkout@v4

      - name: Install dependencies
        run: npm ci

      - name: Run Playwright tests
        run: npx playwright test --shard=${{ matrix.shard }}/4

      - name: Upload blob report
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: blob-report-${{ matrix.shard }}
          path: blob-report
          retention-days: 1

  merge-reports:
    if: always()
    needs: [test]
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: Install dependencies
        run: npm ci

      - name: Download blob reports
        uses: actions/download-artifact@v3
        with:
          path: all-blob-reports
          pattern: blob-report-*
          merge-multiple: true

      - name: Merge reports
        run: npx playwright merge-reports --reporter html ./all-blob-reports

      - name: Upload HTML report
        uses: actions/upload-artifact@v3
        with:
          name: html-report--attempt-${{ github.run_attempt }}
          path: playwright-report
          retention-days: 14
```

---

## Example 6: AI-Assisted Test Data Generation

```typescript
// utils/ai-data-generator.ts
// Prompt template for generating test data with AI

export const generateTestDataPrompt = (entityType: string, count: number) => `
Generate ${count} test data objects for ${entityType}.

Requirements:
- Realistic data
- Include edge cases (long names, special characters, etc.)
- Valid format for each field
- Return as TypeScript array

Entity type: ${entityType}
`;

// Example usage with AI-generated output
// This would be generated by ChatGPT/Claude

export const generatedUsers = [
  {
    firstName: 'John',
    lastName: 'Smith',
    email: 'john.smith@example.com',
    password: 'SecurePass123!',
    phone: '555-123-4567',
  },
  {
    firstName: "O'Brien",
    lastName: 'García-López',
    email: 'obrien.garcia@example.com',
    password: 'Contraseña456!',
    phone: '+1-555-987-6543',
  },
  {
    firstName: 'Test',
    lastName: 'WithVeryLongLastNameThatMightCauseUIIssues',
    email: 'test.longlastname@example.com',
    password: 'LongPassword789!',
    phone: '555-000-0000',
  },
  {
    firstName: '田中',
    lastName: '太郎',
    email: 'tanaka.taro@example.co.jp',
    password: 'パスワード123!',
    phone: '+81-3-1234-5678',
  },
  {
    firstName: '',  // Edge case: empty
    lastName: 'Anonymous',
    email: 'anonymous@example.com',
    password: 'Anonymous123!',
    phone: '',
  },
];

// Combined with faker for dynamic generation
import { faker } from '@faker-js/faker';

export const createUserWithAIPatterns = () => {
  // Use AI-identified edge cases with faker
  const patterns = [
    () => ({
      firstName: faker.person.firstName(),
      lastName: faker.person.lastName(),
    }),
    () => ({
      firstName: `${faker.person.firstName()}-${faker.person.firstName()}`,
      lastName: `O'${faker.person.lastName()}`,
    }),
    () => ({
      firstName: faker.lorem.words(5), // Long name
      lastName: faker.lorem.words(5),
    }),
  ];

  const pattern = faker.helpers.arrayElement(patterns);
  return {
    ...pattern(),
    email: faker.internet.email(),
    password: faker.internet.password({ length: 12, memorable: false }),
    phone: faker.phone.number(),
  };
};
```

---

## Example 7: Self-Healing Locator Concept

```typescript
// utils/resilient-locator.ts
// Conceptual implementation of self-healing locators

import { Page, Locator } from '@playwright/test';

interface LocatorStrategy {
  type: 'testid' | 'css' | 'text' | 'role';
  value: string;
  priority: number;
}

export class ResilientLocator {
  private page: Page;
  private strategies: LocatorStrategy[];
  private lastWorkingStrategy: LocatorStrategy | null = null;

  constructor(page: Page, strategies: LocatorStrategy[]) {
    this.page = page;
    this.strategies = strategies.sort((a, b) => a.priority - b.priority);
  }

  async find(): Promise<Locator> {
    // Try last working strategy first
    if (this.lastWorkingStrategy) {
      const locator = this.getLocator(this.lastWorkingStrategy);
      if (await this.isValid(locator)) {
        return locator;
      }
    }

    // Try each strategy in priority order
    for (const strategy of this.strategies) {
      const locator = this.getLocator(strategy);

      if (await this.isValid(locator)) {
        // Update last working strategy
        if (strategy !== this.lastWorkingStrategy) {
          console.log(`Locator healed: using ${strategy.type}="${strategy.value}"`);
          this.lastWorkingStrategy = strategy;
        }
        return locator;
      }
    }

    throw new Error('No valid locator found. Element may not exist.');
  }

  private getLocator(strategy: LocatorStrategy): Locator {
    switch (strategy.type) {
      case 'testid':
        return this.page.locator(`[data-testid="${strategy.value}"]`);
      case 'css':
        return this.page.locator(strategy.value);
      case 'text':
        return this.page.locator(`text=${strategy.value}`);
      case 'role':
        return this.page.getByRole(strategy.value as any);
      default:
        throw new Error(`Unknown strategy type: ${strategy.type}`);
    }
  }

  private async isValid(locator: Locator): Promise<boolean> {
    try {
      const count = await locator.count();
      return count === 1;
    } catch {
      return false;
    }
  }
}

// Usage
const submitButton = new ResilientLocator(page, [
  { type: 'testid', value: 'submit-button', priority: 1 },
  { type: 'css', value: 'button[type="submit"]', priority: 2 },
  { type: 'text', value: 'Submit', priority: 3 },
  { type: 'role', value: 'button', priority: 4 },
]);

const locator = await submitButton.find();
await locator.click();
```

---

## Example 8: AI Code Review Prompt

```markdown
# Code Review Prompt

Review this Playwright test code for best practices, potential issues, and improvements.

```typescript
import { test, expect } from '@playwright/test';

test('complete checkout', async ({ page }) => {
  await page.goto('https://shop.example.com');

  // Add item
  await page.click('.product:first-child .add-btn');
  await page.waitForTimeout(1000);

  // Go to cart
  await page.click('#cart-icon');
  await page.waitForTimeout(500);

  // Checkout
  await page.fill('#card-number', '4111111111111111');
  await page.fill('#expiry', '12/25');
  await page.fill('#cvv', '123');
  await page.click('#pay-btn');

  await page.waitForTimeout(3000);
  expect(await page.isVisible('.success')).toBeTruthy();
});
```

Provide specific suggestions with improved code examples.

---

# AI Review Response

## Issues Found

### 1. Arbitrary Timeouts (Critical)
Using `waitForTimeout` causes flakiness. Replace with explicit waits.

### 2. Hardcoded Sensitive Data (Security)
Card number is hardcoded. Use environment variables.

### 3. Non-Semantic Selectors (Maintainability)
CSS selectors are brittle. Use data-testid.

### 4. Missing Page Object Model (Structure)
Test should use POM for reusability.

### 5. Weak Assertion (Reliability)
`isVisible()` with `toBeTruthy()` is less clear than direct assertion.

## Improved Code

```typescript
import { test, expect } from '@playwright/test';
import { CheckoutPage } from '../pages/CheckoutPage';

test('complete checkout', async ({ page }) => {
  const checkout = new CheckoutPage(page);

  await page.goto('/');

  // Add item with proper wait
  await page.click('[data-testid="add-to-cart"]');
  await expect(page.locator('[data-testid="cart-count"]')).toHaveText('1');

  // Go to cart
  await page.click('[data-testid="cart-icon"]');
  await expect(page).toHaveURL(/cart/);

  // Checkout with secure data
  await checkout.fillPaymentDetails({
    cardNumber: process.env.TEST_CARD_NUMBER!,
    expiry: process.env.TEST_CARD_EXPIRY!,
    cvv: process.env.TEST_CARD_CVV!,
  });

  await checkout.submit();

  // Clear assertion
  await expect(page.locator('[data-testid="success-message"]')).toBeVisible();
});
```
```

---

## Example 9: Parallel Execution Configuration

```typescript
// playwright.config.ts - Optimized for parallel execution
import { defineConfig, devices } from '@playwright/test';

export default defineConfig({
  testDir: './tests',

  // Parallel execution
  fullyParallel: true,
  workers: process.env.CI ? 4 : '50%',

  // Fail fast in CI
  forbidOnly: !!process.env.CI,

  // Retries for flaky tests
  retries: process.env.CI ? 2 : 0,

  // Timeouts
  timeout: 30000,
  expect: {
    timeout: 5000,
  },

  // Reporter
  reporter: process.env.CI
    ? [['github'], ['html', { open: 'never' }], ['blob']]
    : [['list'], ['html']],

  use: {
    baseURL: process.env.BASE_URL || 'http://localhost:3000',
    trace: 'on-first-retry',
    screenshot: 'only-on-failure',
    video: 'retain-on-failure',
  },

  projects: [
    // Auth setup (runs first)
    {
      name: 'setup',
      testMatch: /.*\.setup\.ts/,
    },

    // Desktop browsers
    {
      name: 'chromium',
      use: { ...devices['Desktop Chrome'] },
      dependencies: ['setup'],
    },
    {
      name: 'firefox',
      use: { ...devices['Desktop Firefox'] },
      dependencies: ['setup'],
    },
    {
      name: 'webkit',
      use: { ...devices['Desktop Safari'] },
      dependencies: ['setup'],
    },

    // Mobile
    {
      name: 'mobile',
      use: { ...devices['iPhone 13'] },
      dependencies: ['setup'],
    },
  ],

  // Local dev server
  webServer: process.env.CI ? undefined : {
    command: 'npm run dev',
    url: 'http://localhost:3000',
    reuseExistingServer: !process.env.CI,
  },
});
```

---

## Example 10: Future QA Skills Assessment Tool

```typescript
// utils/skills-assessment.ts
// Tool for tracking QA skill development

interface Skill {
  name: string;
  category: 'technical' | 'soft';
  currentLevel: number; // 1-5
  targetLevel: number;
  resources: string[];
}

interface Assessment {
  date: string;
  skills: Skill[];
  goals: string[];
  nextSteps: string[];
}

export const createAssessment = (): Assessment => ({
  date: new Date().toISOString().split('T')[0],
  skills: [
    // Technical skills
    {
      name: 'Prompt Engineering',
      category: 'technical',
      currentLevel: 0,
      targetLevel: 4,
      resources: [
        'OpenAI Prompt Engineering Guide',
        'Anthropic Claude Documentation',
      ],
    },
    {
      name: 'Cloud Infrastructure',
      category: 'technical',
      currentLevel: 0,
      targetLevel: 3,
      resources: [
        'Docker Documentation',
        'GitHub Actions Guides',
      ],
    },
    {
      name: 'Security Testing',
      category: 'technical',
      currentLevel: 0,
      targetLevel: 3,
      resources: [
        'OWASP Testing Guide',
        'Burp Suite Academy',
      ],
    },
    {
      name: 'Performance Testing',
      category: 'technical',
      currentLevel: 0,
      targetLevel: 3,
      resources: [
        'Web Performance MDN',
        'Lighthouse Documentation',
      ],
    },

    // Soft skills
    {
      name: 'Critical Thinking',
      category: 'soft',
      currentLevel: 0,
      targetLevel: 5,
      resources: [
        'Exploratory Testing Books',
        'Critical Thinking Courses',
      ],
    },
    {
      name: 'Communication',
      category: 'soft',
      currentLevel: 0,
      targetLevel: 4,
      resources: [
        'Technical Writing Courses',
        'Documentation Best Practices',
      ],
    },
  ],
  goals: [],
  nextSteps: [],
});

export const generateLearningPlan = (assessment: Assessment): string => {
  const gaps = assessment.skills
    .filter(s => s.currentLevel < s.targetLevel)
    .sort((a, b) => (b.targetLevel - b.currentLevel) - (a.targetLevel - a.currentLevel));

  let plan = '# 30-Day Learning Plan\n\n';

  gaps.slice(0, 3).forEach((skill, index) => {
    plan += `## Week ${index + 1}: ${skill.name}\n`;
    plan += `Current: ${skill.currentLevel}/5 | Target: ${skill.targetLevel}/5\n\n`;
    plan += `Resources:\n`;
    skill.resources.forEach(r => {
      plan += `- ${r}\n`;
    });
    plan += '\n';
  });

  return plan;
};
```

---

## Example 11: Integration Test with AI Assistance

```typescript
// tests/ai-assisted-integration.spec.ts
// Test generated with AI assistance and human review

import { test, expect } from '@playwright/test';
import { userFactory } from '../utils/factories';
import { LoginPage } from '../pages/LoginPage';
import { DashboardPage } from '../pages/DashboardPage';
import { ProfilePage } from '../pages/ProfilePage';

test.describe('User Profile Management', () => {
  let loginPage: LoginPage;
  let dashboardPage: DashboardPage;
  let profilePage: ProfilePage;

  test.beforeEach(async ({ page }) => {
    loginPage = new LoginPage(page);
    dashboardPage = new DashboardPage(page);
    profilePage = new ProfilePage(page);
  });

  test('user can update profile information', async ({ page }) => {
    // Arrange - Create test user
    const user = userFactory.create();
    const newName = userFactory.create().firstName;

    // Act - Login and navigate to profile
    await loginPage.goto();
    await loginPage.login(user.email, user.password);
    await dashboardPage.waitForLoad();
    await dashboardPage.goToProfile();

    // Update profile
    await profilePage.updateName(newName);
    await profilePage.save();

    // Assert - Verify update
    await expect(profilePage.successMessage).toBeVisible();
    await expect(profilePage.nameField).toHaveValue(newName);

    // Verify persistence
    await page.reload();
    await expect(profilePage.nameField).toHaveValue(newName);
  });

  test('validates required fields', async ({ page }) => {
    const user = userFactory.create();

    await loginPage.goto();
    await loginPage.login(user.email, user.password);
    await dashboardPage.goToProfile();

    // Clear required field
    await profilePage.clearName();
    await profilePage.save();

    // Should show validation error
    await expect(profilePage.nameError).toBeVisible();
    await expect(profilePage.nameError).toContainText('required');
  });
});
```

---

## Example 12: AI Prompt Library

```typescript
// utils/prompt-library.ts
// Reusable prompts for AI-assisted testing

export const prompts = {
  testGeneration: (feature: string, context: string) => `
Generate Playwright tests in TypeScript for ${feature}.

Context: ${context}

Requirements:
- Use Page Object Model
- Include positive and negative test cases
- Handle loading states
- Use data-testid selectors
- Follow Playwright 1.40+ best practices

Output: Page object class and test file.
`,

  debugging: (error: string, code: string, html: string) => `
Debug this failing Playwright test.

Error: ${error}

Code:
\`\`\`typescript
${code}
\`\`\`

HTML:
\`\`\`html
${html}
\`\`\`

What's wrong and how do I fix it?
`,

  codeReview: (code: string) => `
Review this Playwright test code for:
- Best practices
- Potential flakiness
- Security issues
- Code duplication
- Missing assertions

\`\`\`typescript
${code}
\`\`\`

Provide specific improvements with examples.
`,

  refactoring: (code: string, pattern: string) => `
Refactor this test code to use ${pattern}.

\`\`\`typescript
${code}
\`\`\`

Maintain all existing functionality while improving structure.
`,

  testData: (entity: string, cases: string[]) => `
Generate test data for ${entity} entity.

Include these cases:
${cases.map(c => `- ${c}`).join('\n')}

Return as TypeScript objects with proper types.
`,
};

// Usage
const prompt = prompts.testGeneration(
  'user registration',
  'E-commerce site with email verification'
);
```

---

*Module 12 Code Examples*
*MentorMate QA Automation Course*
